<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rs.teach.mapper.studyAttr.dao.CourseMapper">
	<resultMap type="com.rs.teach.mapper.studyAttr.entity.Course" id="courseById">
		<result property="courseId" column="course_id" />
		<result property="courseName" column="course_name" />
	</resultMap>
	<delete id="deleteCourse">
		delete from TF_EL_COURSE
		where COURSE_ID=#{courseId}

	</delete>

	<select id="queryCourseById" parameterType="java.lang.String" resultMap="courseById">
		select co.course_id,co.course_name from tf_el_course co, user_course_rela re 
		where co.course_id = re.course_id
			  and re.user_id = #{userId}
			  and re.rela_type = '1' group by co.course_id,co.course_name
	</select>
	
	<resultMap type="java.util.HashMap" id="InfoMap">
		<result property="classId" column="class_id" />
		<result property="className" column="class_name" />
		<result property="courseId" column="course_id" />
		<result property="courseName" column="course_name" />
		<result property="sectionNumber" column="section_number" />
	</resultMap>
	
	<select id="courseInfoForUser" parameterType="java.lang.String" resultMap="InfoMap">
		select re.class_id, cl.class_name,re.course_id,tc.course_name,tc.section_number 
			from user_course_rela re, tf_el_course tc,tf_el_class cl 
		<where> 
			  re.course_id = tc.course_id 
			  and re.class_id = cl.class_id 
			  and re.user_id = #{userId} and re.rela_type = '1'
			  <if test="classId != null and classId != ''">
			  	and re.class_id = #{classId}
			  </if>
		</where>
	</select>
	
	<resultMap type="java.util.HashMap" id="secMap">
		<result property="sectionId" column="section_id" />
		<result property="sectionSort" column="section_SORT" />
		<result property="sectionName" column="section_name" />
		<result property="totleSectionSort" column="totleSection_sort" />
		<result property="totleSectionName" column="totleSection_name" />
	</resultMap>
	
	<select id="finishStudy" parameterType="java.lang.String" resultMap="secMap">
		select re.section_id,ts.section_name,ts.section_SORT,ts.totleSection_sort,ts.totleSection_name from user_course_rela re, tf_el_section ts 
		where re.section_id = ts.section_id 
		  and re.rela_type = '0' 
		  and re.user_id = #{userId}
		  and re.course_id = #{courseId}
		  and re.class_id = #{classId} 
		  and re.isfinish = '2'
	</select>
	
	<resultMap type="java.util.HashMap" id="noteMap">
		<result property="sectionId" column="section_Id" />
		<result property="sectionSort" column="section_SORT" />
		<result property="sectionName" column="section_name" />
		<result property="sectionUrl" column="section_url" />
		<result property="classId" column="class_id" />
		<result property="classNote" column="note" />
		<result property="courseId" column="course_id" />
	</resultMap>
	<select id="queryNote" parameterType="map" resultMap="noteMap">
		select ts.section_Id,ts.section_SORT, ts.section_name,ts.section_url,ns.class_id,ns.note,ns.course_id 
			from tf_el_note ns, tf_el_section ts 
		where ns.section_id = ts.section_id 
			  and ns.user_id = #{con_userId} 
			  and ns.course_id = #{con_courseId} 
			  and ns.class_id = #{con_classId}
			  and ns.section_id = #{con_sectionId}
	</select>
	
	<resultMap type="java.util.HashMap" id="summaryMap">
		<result property="sectionId" column="section_Id" />
		<result property="sectionSort" column="section_SORT" />
		<result property="sectionName" column="section_name" />
		<result property="classId" column="class_id" />
		<result property="classSummary" column="summary" />
		<result property="courseId" column="course_id" />
	</resultMap>
	<select id="querySummary" parameterType="map" resultMap="summaryMap">
		select ts.section_Id,ts.section_SORT, ts.section_name,ns.class_id,ns.summary,ns.course_id 
			from tf_el_summary ns, tf_el_section ts 
		where ns.section_id = ts.section_id
			  and ns.user_id = #{con_userId} 
			  and ns.course_id = #{con_courseId} 
			  and ns.class_id = #{con_classId}
			  and ns.section_id = #{con_sectionId}
	</select>
	
	<select id="isExsitSummary" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(1) from tf_el_summary t 
		where t.USER_ID = #{userId} 
			and t.SECTION_ID = #{sectionId} 
			and t.class_id = #{classId}
	</select>
	
	<update id="updateSummary" parameterType="com.rs.teach.mapper.studyAttr.entity.NoteSummary">
		update tf_el_summary t set t.SUMMARY = #{summary}
			where t.USER_ID = #{userId} and t.SECTION_ID = #{sectionId} and t.CLASS_ID = #{classId}
	</update>

	<insert id="insertSummary" parameterType="com.rs.teach.mapper.studyAttr.entity.NoteSummary">
		insert into tf_el_summary
			(
				USER_ID,
				SECTION_ID,
				COURSE_ID,
				CLASS_ID,
				SUMMARY
			)
		values
			(
				#{userId},
				#{sectionId},
				#{courseId},
				#{classId},
				#{summary}
			)
	</insert>
    <resultMap type="com.rs.teach.mapper.studyAttr.entity.Course" id="queryCourseMap">
		<result property="courseId" column="COURSE_ID" />
		<result property="courseName" column="COURSE_NAME" />
		<result property="sectionNumber" column="SECTION_NUMBER" />
		<result property="coursePicUrl" column="COURSEPIC_URL" /> 
		<result property="courseWare" column="COURSEWARE" />
		<result property="schoolWork" column="SCHOOLWORK" />
		<result property="testPaper" column="TESTPAPER" />
		<result property="courseType" column="COURSE_TYPE" />
		<result property="schoolId" column="SCHOOL_ID" />
		<result property="courseLev" column="COURSE_LEV" />
	</resultMap>
	<!-- 分页查询课程信息 -->
	<select id="queryCourse" parameterType="map" resultMap="queryCourseMap">
		select * from tf_el_course t 
			<where>
				1 = 1
				<if test="con_courseType != null and con_courseType != ''">
					and t.COURSE_TYPE = #{con_courseType}
				</if>
				<if test="con_schoolId != null and con_schoolId != ''">
					and t.SCHOOL_ID = #{con_schoolId}
				</if>
				<if test="con_courseLev != null and con_courseLev != ''">
					and t.COURSE_LEV = #{con_courseLev}
				</if>
				<if test="con_likeSearch != null and con_likeSearch != ''">
					and t.COURSE_NAME like '%'||#{con_likeSearch}||'%'
				</if>
			</where> 
	</select>
	
	<!-- 根据课程id查询课程信息 -->
	<select id="selectCourseByCourseId" parameterType="java.lang.String" resultMap="queryCourseMap">
		select * from tf_el_course where COURSE_ID = #{courseId}
	</select>

	<select id="selectCourse" resultType="com.rs.teach.mapper.studyAttr.entity.Course">
		select 	COURSE_ID ,COURSE_NAME,COURSEPIC_URL
		from TF_EL_COURSE
	</select>

	<insert id="addCourse" parameterType="com.rs.teach.mapper.studyAttr.dto.CourseDto">
		insert into TF_EL_COURSE(
					course_id, course_name, coursepic_url, courseware,
					schoolwork, testpaper, course_type, school_id, course_lev
					)
		values (SEQ_EL_COURSE.nextval,#{courseName},#{coursePicUrl},#{courseware},
				#{schoolwork},#{testpaper},#{courseType},#{schoolId},#{courseLev})
	</insert>

	<update id="updateCourse" parameterType="com.rs.teach.mapper.studyAttr.dto.CourseDto">
		update TF_EL_COURSE
		<set>
			<if test="courseName !=null and courseName !=''">
				course_name = #{courseName}
			</if>
			<if test="coursePicUrl !=null and coursePicUrl !=''">
				coursepic_url = #{coursePicUrl}
			</if>
			<if test="courseName !=null and courseName !=''">
				courseware =#{courseware}
			</if>
			<if test="courseName !=null and courseName !=''">
				schoolwork =#{schoolwork}
			</if>
			<if test="courseName !=null and courseName !=''">
				testpaper =#{testpaper}
			</if>
			<if test="courseName !=null and courseName !=''">
				course_type =#{courseType}
			</if>
			<if test="courseName !=null and courseName !=''">
				school_id =#{schoolId}
			</if>
			<if test="courseName !=null and courseName !=''">
				course_lev =#{courseLev}
			</if>
		</set>
		where COURSE_ID = #{courseId}
	</update>

	<!-- 课程笔记 -->
	<select id="isExsitNote" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(1) from tf_el_note t
		where t.USER_ID = #{userId}
			and t.SECTION_ID = #{sectionId}
			and t.class_id = #{classId}
	</select>

	<insert id="insertNote" parameterType="com.rs.teach.mapper.studyAttr.entity.NoteSummary">
		insert into tf_el_note
			(
				USER_ID,
				SECTION_ID,
				COURSE_ID,
				CLASS_ID,
				NOTE
			)
		values
			(
				#{userId},
				#{sectionId},
				#{courseId},
				#{classId},
				#{note}
			)
	</insert>

	<update id="updateNote" parameterType="com.rs.teach.mapper.studyAttr.entity.NoteSummary">
		update tf_el_note t set t.NOTE = #{note}
			where t.USER_ID = #{userId} and t.SECTION_ID = #{sectionId} and t.CLASS_ID = #{classId}
	</update>

	<!-- 分组查询课程类型和等级 -->
	<select id="groupCourseType" resultType="java.lang.String">
		select t.course_type from tf_el_course t group by t.course_type
	</select>
	<select id="groupCourseLev" resultType="java.lang.String">
		select t.course_lev from tf_el_course t group by t.course_lev
	</select>

    <select id="selectTrainCourse" resultType="com.rs.teach.mapper.studyAttr.vo.TrainCourseVo">
		select COURSE_ID
		from TF_EL_COURSE
	</select>

    <select id="selectCourseById" resultType="com.rs.teach.mapper.studyAttr.vo.TrainCourseVo">
		select COURSE_ID AS train_course_Id,
              COURSE_NAME AS train_course_Name,
              COURSEPIC_URL AS TRAIN_COURSEPIC_URL
        from tf_el_course
        where course_Id = #{courseId}
	</select>
</mapper>